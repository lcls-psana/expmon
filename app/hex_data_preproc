#!@PYTHON@
#------------------------------

import os
import sys
import expmon.HexUtils as hu
from expmon.HexDataPreProc import preproc_data

#------------------------------

def usage():
    return 'command examples\n'\
           '  mpirun -n 8 hex_data_preproc -n 2000 <other-options>\n'\
           '  bsub -o log-mpi-n08-%J.log -q psnehq -n 8 mpirun hex_data_preproc -n 1000000 <other-options>\n'\
           '  hex_data_preproc -d exp=xpptut15:run=390:smd -n 1200 <other-options>\n'\
           '  hex_data_preproc -h'

#------------------------------

def hex_data_preproc() :
    """
    """
    parser = input_option_parser()

    if len(sys.argv) == 1 : 
        parser.print_help()
	print 80*'_'
        parser.print_usage()
	print 80*'_'
        msg = 'WARNING: ALL DEFAULT PARAMETERS ARE USELESS...'
	#print msg
	sys.exit(msg)

    (popts, pargs) = parser.parse_args()
    opts = vars(popts)

    #dsname   = popts.dsname
    #defs = vars(parser.get_default_values())
    #if verbos :
    #    print 'arguments: "%s"' % str(pargs)
    #    print 'options  : %s' % str(popts)
    #    for k,v in vars(popts).iteritems() : print '  %10s : %10s' % (k,v)

    opts['srcchs'] = hu.dict_from_str_srcchs(popts.srcchs)
    kwargs = opts
    hu.print_kwargs(kwargs)
    preproc_data(**kwargs)

#------------------------------

def input_option_parser() :

    from optparse import OptionParser

    d_srcchs = "{'AmoETOF.0:Acqiris.0':(6,7,8,9,10,11),'AmoITOF.0:Acqiris.0':(0,)}"
    d_dsname = 'exp=xpptut15:run=390:smd'
    d_evskip = 0
    d_events = 1000
    d_ofpref = './'
    d_numchs = 7
    d_numhts = 16
    d_verbos = True

    h_srcchs = 'sources and channels, string like dict, no spaces, default = %s' % d_srcchs
    h_dsname = 'data set name, default = %s' % d_dsname
    h_evskip = 'number of events to skip before start processing, default = %s' % d_evskip
    h_events = 'number of events to process, default = %s' % d_events
    h_ofpref = 'output file prefix, default = %s' % d_ofpref
    h_numchs = 'number of waveform detector channels, default = %s' % d_numchs
    h_numhts = 'maximal number of hits per channel, default = %s' % d_numhts
    h_verbos = 'verbosity, default = %s' % d_verbos

    parser = OptionParser(description='Process hexanode xtc data and creates "small data" hdf5', usage=usage())

    parser.add_option('-s', '--srcchs', default=d_srcchs, action='store', type='string', help=h_srcchs)
    parser.add_option('-d', '--dsname', default=d_dsname, action='store', type='string', help=h_dsname)
    parser.add_option('-m', '--evskip', default=d_evskip, action='store', type='int',    help=h_evskip)
    parser.add_option('-n', '--events', default=d_events, action='store', type='int',    help=h_events)
    parser.add_option('-o', '--ofpref', default=d_ofpref, action='store', type='string', help=h_ofpref)
    parser.add_option('-C', '--numchs', default=d_numchs, action='store', type='int',    help=h_numchs)
    parser.add_option('-H', '--numhts', default=d_numhts, action='store', type='int',    help=h_numhts)
    parser.add_option('-v', '--verbos', default=d_verbos, action='store_false',          help=h_verbos)

    #parser.add_option('-', '--', default=d_ins, action='store', type='string', help=h_)

    return parser
  
#------------------------------

if __name__ == "__main__" :
    hex_data_preproc()
    sys.exit(0)

#------------------------------
